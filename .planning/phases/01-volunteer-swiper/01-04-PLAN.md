---
phase: 01-volunteer-swiper
plan: 04
type: execute
---

<objective>
Refactor ActivitySwiper to use new SwipeableCard and SwipeButtons components with card stack UI.

Purpose: Wire up the swiper with proper card stacking, state management, and animations
Output: Working swiper with drag gestures and button controls
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PERSON3-VOLUNTEER-SWIPER-DESIGN.md
@frontend/src/components/volunteer/ActivitySwiper.jsx
@frontend/src/components/volunteer/SwipeableCard.jsx
@frontend/src/components/volunteer/SwipeButtons.jsx
@frontend/src/services/matches.api.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor ActivitySwiper with card stack</name>
  <files>frontend/src/components/volunteer/ActivitySwiper.jsx</files>
  <action>
    Replace ActivitySwiper.jsx with new implementation using SwipeableCard and SwipeButtons:

    ```jsx
    import { useState, useEffect, useRef } from 'react'
    import { AnimatePresence } from 'framer-motion'
    import { matchesApi } from '../../services/matches.api'
    import SwipeableCard from './SwipeableCard'
    import SwipeButtons from './SwipeButtons'
    import EmptyState from '../shared/EmptyState'
    import Button from '../shared/Button'
    import Spinner from '../shared/Spinner'

    const VISIBLE_CARDS = 3 // Number of cards to show in stack

    export default function ActivitySwiper({ onMatch }) {
      const [activities, setActivities] = useState([])
      const [currentIndex, setCurrentIndex] = useState(0)
      const [loading, setLoading] = useState(true)
      const [swiping, setSwiping] = useState(false)
      const cardRef = useRef(null)

      useEffect(() => {
        fetchAvailableActivities()
      }, [])

      const fetchAvailableActivities = async () => {
        try {
          setLoading(true)
          const response = await matchesApi.getAvailable()
          setActivities(response.data || [])
        } catch (error) {
          console.error('Failed to fetch activities:', error)
        } finally {
          setLoading(false)
        }
      }

      const handleSwipe = async (direction) => {
        if (swiping) return
        setSwiping(true)

        const activity = activities[currentIndex]

        if (direction === 'right') {
          try {
            await matchesApi.create({ activity_id: activity.id })
            console.log('Matched with activity:', activity.title)

            // Trigger match celebration callback
            if (onMatch) {
              onMatch(activity)
            }
          } catch (error) {
            console.error('Failed to match:', error)
          }
        }

        // Move to next card after animation completes
        setTimeout(() => {
          setCurrentIndex(prev => prev + 1)
          setSwiping(false)
        }, 50)
      }

      const handleButtonSwipe = (direction) => {
        // The SwipeableCard will handle its own animation via controls
        handleSwipe(direction)
      }

      if (loading) {
        return (
          <div className="flex items-center justify-center py-16">
            <Spinner size="large" />
          </div>
        )
      }

      if (activities.length === 0) {
        return (
          <EmptyState
            title="No activities available"
            description="Check back later for more volunteer opportunities"
          />
        )
      }

      if (currentIndex >= activities.length) {
        return (
          <EmptyState
            title="All done!"
            description="You've reviewed all available activities"
            action={
              <Button onClick={() => setCurrentIndex(0)}>
                Start Over
              </Button>
            }
          />
        )
      }

      // Get visible cards for stack effect
      const visibleActivities = activities.slice(
        currentIndex,
        currentIndex + VISIBLE_CARDS
      )

      return (
        <div className="max-w-md mx-auto px-4">
          {/* Card Stack */}
          <div className="relative h-[480px] mb-8">
            <AnimatePresence>
              {visibleActivities.map((activity, index) => (
                <SwipeableCard
                  key={activity.id}
                  activity={activity}
                  onSwipe={handleSwipe}
                  isTop={index === 0}
                  stackIndex={index}
                />
              ))}
            </AnimatePresence>
          </div>

          {/* Swipe Buttons */}
          <SwipeButtons
            onPass={() => handleButtonSwipe('left')}
            onMatch={() => handleButtonSwipe('right')}
            disabled={swiping}
          />

          {/* Progress */}
          <div className="mt-6 text-center text-gray-500 text-sm">
            {currentIndex + 1} of {activities.length} activities
          </div>
        </div>
      )
    }
    ```

    Key changes from original:
    - Uses SwipeableCard instead of plain ActivityCard
    - AnimatePresence for exit animations
    - Card stack with VISIBLE_CARDS constant
    - onMatch callback for parent to trigger celebration
    - swiping state prevents double-swipes
    - Improved loading state with Spinner
  </action>
  <verify>
    - File compiles without errors (npm run dev)
    - Imports resolve correctly
    - Component renders without crashing
  </verify>
  <done>ActivitySwiper refactored to use SwipeableCard and SwipeButtons with card stack</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Tinder-style activity swiper with drag gestures and button controls</what-built>
  <how-to-verify>
    1. Run: `cd frontend && npm run dev`
    2. Open browser to http://localhost:5173
    3. Log in as volunteer (use mock user switcher if available)
    4. Navigate to Activities or Swiper section

    Test the following:
    5. **Card Stack**: Verify 3 cards visible with depth effect (smaller/offset behind)
    6. **Drag Right**: Drag top card right, see "MATCH!" indicator appear, card exits right
    7. **Drag Left**: Drag card left, see "PASS" indicator appear, card exits left
    8. **Snap Back**: Drag card slightly and release - should snap back to center
    9. **Buttons**: Click X button (pass) and Heart button (match) - cards should animate out
    10. **Progress**: Counter updates after each swipe
    11. **End State**: After all cards, see "All done!" message

    Note: Match celebration animation not yet implemented (next plan)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ActivitySwiper.jsx refactored with new components
- [ ] Card stack displays with depth effect
- [ ] Drag gestures work (left/right)
- [ ] Buttons work (pass/match)
- [ ] Progress counter updates
- [ ] Human verification passed
</verification>

<success_criteria>
- All tasks completed
- Swipe gestures work correctly
- Button fallback works correctly
- Card stack animates properly
- Human verified the interaction
</success_criteria>

<output>
After completion, create `.planning/phases/01-volunteer-swiper/01-04-SUMMARY.md`
</output>
