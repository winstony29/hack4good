---
phase: 01-volunteer-swiper
plan: 05
type: execute
---

<objective>
Create MatchAnimation celebration component and wire it into the complete swiper flow.

Purpose: Add delightful "It's a Match!" celebration with confetti when volunteer matches
Output: Working end-to-end swiper with match celebration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PERSON3-VOLUNTEER-SWIPER-DESIGN.md
@frontend/src/components/volunteer/ActivitySwiper.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MatchAnimation component</name>
  <files>frontend/src/components/volunteer/MatchAnimation.jsx</files>
  <action>
    Create MatchAnimation.jsx with confetti celebration:

    ```jsx
    import { useEffect, useCallback } from 'react'
    import { motion, AnimatePresence } from 'framer-motion'
    import confetti from 'canvas-confetti'
    import { Heart, X } from 'lucide-react'

    export default function MatchAnimation({ activity, isVisible, onClose }) {
      // Fire confetti when animation becomes visible
      useEffect(() => {
        if (isVisible) {
          // Delay confetti slightly for dramatic effect
          const timer = setTimeout(() => {
            confetti({
              particleCount: 100,
              spread: 70,
              origin: { y: 0.6 },
              colors: ['#22c55e', '#16a34a', '#4ade80', '#86efac']
            })
          }, 300)

          // Auto-dismiss after 2.5 seconds
          const dismissTimer = setTimeout(() => {
            onClose()
          }, 2500)

          return () => {
            clearTimeout(timer)
            clearTimeout(dismissTimer)
          }
        }
      }, [isVisible, onClose])

      const handleBackdropClick = useCallback((e) => {
        if (e.target === e.currentTarget) {
          onClose()
        }
      }, [onClose])

      return (
        <AnimatePresence>
          {isVisible && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              transition={{ duration: 0.2 }}
              className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm"
              onClick={handleBackdropClick}
            >
              {/* Close button */}
              <button
                onClick={onClose}
                className="absolute top-4 right-4 p-2 text-white/80 hover:text-white transition-colors"
                aria-label="Close"
              >
                <X className="w-8 h-8" />
              </button>

              {/* Content */}
              <div className="text-center px-4">
                {/* Heart icon */}
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  transition={{ type: 'spring', stiffness: 260, damping: 20, delay: 0.1 }}
                >
                  <div className="w-24 h-24 mx-auto mb-6 bg-green-500 rounded-full flex items-center justify-center shadow-lg shadow-green-500/50">
                    <Heart className="w-12 h-12 text-white" fill="white" />
                  </div>
                </motion.div>

                {/* Title */}
                <motion.h2
                  initial={{ scale: 0.5, opacity: 0 }}
                  animate={{ scale: 1, opacity: 1 }}
                  transition={{ type: 'spring', stiffness: 260, damping: 20, delay: 0.2 }}
                  className="text-4xl font-bold text-white mb-2"
                >
                  It's a Match!
                </motion.h2>

                {/* Activity info */}
                <motion.div
                  initial={{ y: 20, opacity: 0 }}
                  animate={{ y: 0, opacity: 1 }}
                  transition={{ delay: 0.3 }}
                  className="mb-8"
                >
                  <p className="text-white/80 text-lg">You signed up for</p>
                  <p className="text-white text-xl font-semibold mt-1">
                    {activity?.title}
                  </p>
                </motion.div>

                {/* Keep swiping button */}
                <motion.button
                  initial={{ y: 20, opacity: 0 }}
                  animate={{ y: 0, opacity: 1 }}
                  transition={{ delay: 0.4 }}
                  onClick={onClose}
                  className="px-8 py-3 bg-white text-green-600 font-semibold rounded-full
                             hover:bg-green-50 transition-colors shadow-lg"
                >
                  Keep Swiping
                </motion.button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      )
    }
    ```

    Key features:
    - Confetti burst 300ms after appearing (green colors)
    - Auto-dismiss after 2.5 seconds
    - Click backdrop or X to dismiss early
    - Spring animations for bouncy feel
    - Shows matched activity title
    - "Keep Swiping" button
  </action>
  <verify>
    - File exists at frontend/src/components/volunteer/MatchAnimation.jsx
    - No syntax errors (npm run dev compiles)
    - canvas-confetti import works
  </verify>
  <done>MatchAnimation.jsx created with confetti and celebration UI</done>
</task>

<task type="auto">
  <name>Task 2: Wire MatchAnimation into ActivitySwiper</name>
  <files>frontend/src/components/volunteer/ActivitySwiper.jsx</files>
  <action>
    Update ActivitySwiper.jsx to show MatchAnimation on successful match.

    Add imports at top:
    ```jsx
    import MatchAnimation from './MatchAnimation'
    ```

    Add state for match animation (after other useState):
    ```jsx
    const [matchedActivity, setMatchedActivity] = useState(null)
    const [showMatchAnimation, setShowMatchAnimation] = useState(false)
    ```

    Update the handleSwipe function's success block:
    ```jsx
    if (direction === 'right') {
      try {
        await matchesApi.create({ activity_id: activity.id })
        console.log('Matched with activity:', activity.title)

        // Show match celebration
        setMatchedActivity(activity)
        setShowMatchAnimation(true)

        // Also trigger parent callback if provided
        if (onMatch) {
          onMatch(activity)
        }
      } catch (error) {
        console.error('Failed to match:', error)
      }
    }
    ```

    Add handler to close match animation:
    ```jsx
    const handleCloseMatchAnimation = () => {
      setShowMatchAnimation(false)
      setMatchedActivity(null)
    }
    ```

    Add MatchAnimation component at end of return (before closing div):
    ```jsx
    {/* Match Celebration */}
    <MatchAnimation
      activity={matchedActivity}
      isVisible={showMatchAnimation}
      onClose={handleCloseMatchAnimation}
    />
    ```

    Full updated return should look like:
    ```jsx
    return (
      <div className="max-w-md mx-auto px-4">
        {/* Card Stack */}
        <div className="relative h-[480px] mb-8">
          <AnimatePresence>
            {visibleActivities.map((activity, index) => (
              <SwipeableCard
                key={activity.id}
                activity={activity}
                onSwipe={handleSwipe}
                isTop={index === 0}
                stackIndex={index}
              />
            ))}
          </AnimatePresence>
        </div>

        {/* Swipe Buttons */}
        <SwipeButtons
          onPass={() => handleButtonSwipe('left')}
          onMatch={() => handleButtonSwipe('right')}
          disabled={swiping}
        />

        {/* Progress */}
        <div className="mt-6 text-center text-gray-500 text-sm">
          {currentIndex + 1} of {activities.length} activities
        </div>

        {/* Match Celebration */}
        <MatchAnimation
          activity={matchedActivity}
          isVisible={showMatchAnimation}
          onClose={handleCloseMatchAnimation}
        />
      </div>
    )
    ```
  </action>
  <verify>
    - ActivitySwiper imports MatchAnimation
    - State for matchedActivity and showMatchAnimation exists
    - handleCloseMatchAnimation function exists
    - MatchAnimation rendered in return
    - npm run dev compiles without errors
  </verify>
  <done>MatchAnimation wired into ActivitySwiper, triggers on right swipe</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete volunteer swiper with match celebration animation</what-built>
  <how-to-verify>
    1. Run: `cd frontend && npm run dev`
    2. Open browser to http://localhost:5173
    3. Log in as volunteer
    4. Navigate to Activities or Swiper section

    Test the complete flow:
    5. **Swipe Right (Match)**:
       - Drag card right past threshold
       - "It's a Match!" overlay should appear
       - Green confetti should burst
       - Activity title shown in celebration
       - Auto-dismisses after ~2.5 seconds

    6. **Button Match**:
       - Click the Heart button
       - Same celebration should appear

    7. **Early Dismiss**:
       - Trigger a match
       - Click backdrop, X button, or "Keep Swiping" to dismiss early

    8. **Pass (No Celebration)**:
       - Swipe left or click X button
       - No celebration should appear
       - Card just exits left

    9. **Full Flow**:
       - Swipe through several activities
       - Mix of passes and matches
       - End with "All done!" state

    Demo-ready checklist:
    - [ ] Card stack looks polished
    - [ ] Drag feedback feels responsive
    - [ ] PASS/MATCH indicators visible during drag
    - [ ] Celebration is delightful and not annoying
    - [ ] Confetti colors are visible
    - [ ] Everything works on mobile (touch)
  </how-to-verify>
  <resume-signal>Type "approved" if demo-ready, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] MatchAnimation.jsx created with confetti
- [ ] ActivitySwiper wired to show celebration
- [ ] Right swipe triggers celebration
- [ ] Left swipe does NOT trigger celebration
- [ ] Auto-dismiss works
- [ ] Manual dismiss works (backdrop, X, button)
- [ ] Human verified complete flow
</verification>

<success_criteria>
- All tasks completed
- Match celebration shows on right swipe
- Confetti fires correctly
- Full swiper flow works end-to-end
- Human verified as demo-ready
</success_criteria>

<output>
After completion, create `.planning/phases/01-volunteer-swiper/01-05-SUMMARY.md`:

# Phase 01 Plan 05: Match Animation & Celebration Summary

**Complete volunteer swiper with Tinder-style interactions and match celebration**

## Accomplishments
- Created MatchAnimation component with confetti
- Wired celebration into ActivitySwiper
- End-to-end swiper flow working

## Files Created/Modified
- `frontend/src/components/volunteer/MatchAnimation.jsx` - Celebration overlay
- `frontend/src/components/volunteer/ActivitySwiper.jsx` - Added match animation state

## Decisions Made
- Used canvas-confetti for lightweight confetti (no dependencies)
- 2.5 second auto-dismiss for celebration
- Green color scheme for confetti (matches success theme)

## Known Concerns (Follow-up)
- Reduced motion accessibility: Should disable animations for `prefers-reduced-motion`
- Mobile touch feel: May need threshold tuning after real device testing
- Focus management: After animation dismisses, focus should return to next card

## Phase Complete
Phase 01: Volunteer Swiper is complete. All success criteria met.
</output>
