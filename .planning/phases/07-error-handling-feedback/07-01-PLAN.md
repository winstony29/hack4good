---
phase: 07-error-handling-feedback
plan: 01
type: execute
---

<objective>
Add consistent loading states and standardize async error handling across the application.

Purpose: Ensure users always see feedback during async operations and receive clear error messages when things fail.
Output: All async operations show loading indicators and handle errors with toast notifications.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-animations-transitions/06-01-SUMMARY.md
@.planning/phases/06-animations-transitions/06-02-SUMMARY.md

**Codebase context:**
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STACK.md

**Key files:**
@frontend/src/components/shared/Spinner.jsx
@frontend/src/pages/Activities.jsx
@frontend/src/components/dashboard/ParticipantDashboard.jsx

**Tech available:**
- react-hot-toast 2.4.1 - already configured in App.jsx
- Spinner component exists at components/shared/Spinner.jsx

**Existing patterns:**
- ParticipantDashboard.jsx has good loading/error pattern to follow
- ActivitySwiper.jsx uses toast.promise for loading states
- ActivityDetailModal.jsx has inline error state pattern

**Issues to address:**
- Activities.jsx has no loading state during data fetch
- Error handling is inconsistent (some use toast, some use console.error only)
- No standardized error message format
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add loading state to Activities page</name>
  <files>frontend/src/pages/Activities.jsx</files>
  <action>
Add loading state management to Activities.jsx:
1. Add `const [loading, setLoading] = useState(true)`
2. Add `const [error, setError] = useState(null)`
3. In fetchUserRegistrations and fetchAllActivities, wrap with try/catch and setLoading
4. Show Spinner component when loading (follow ParticipantDashboard pattern)
5. Import toast from react-hot-toast
6. On error, use toast.error with user-friendly message
7. Add EmptyState component for when no activities found

Follow existing patterns from ParticipantDashboard.jsx for consistency.
  </action>
  <verify>
- Run dev server: npm run dev (in frontend/)
- Navigate to /activities
- Verify spinner shows briefly during load
- Check browser console for no errors
- Network throttle to slow 3G and verify loading state visible
  </verify>
  <done>
- Loading spinner visible during fetch
- Error toast shown on fetch failure
- No console.error without user-facing feedback
  </done>
</task>

<task type="auto">
  <name>Task 2: Standardize toast notifications for async operations</name>
  <files>
frontend/src/components/dashboard/ParticipantDashboard.jsx,
frontend/src/components/activities/ActivityDetailModal.jsx,
frontend/src/components/staff/ActivityManager.jsx
  </files>
  <action>
Standardize toast usage across components that have async operations:

1. **ParticipantDashboard.jsx:**
   - Import toast from react-hot-toast
   - Replace `alert('Failed to cancel...')` with `toast.error('Failed to cancel registration. Please try again.')`
   - Add `toast.success('Registration cancelled')` on success

2. **ActivityDetailModal.jsx:**
   - Import toast from react-hot-toast
   - On successful registration, add `toast.success('Successfully registered for activity!')`
   - Keep inline error state but also add toast.error for visibility

3. **ActivityManager.jsx:**
   - Review existing toast usage
   - Ensure all CRUD operations have success/error toasts
   - Format: Success = "Activity [created/updated/deleted] successfully"
   - Format: Error = "[Action] failed. Please try again."

Pattern to follow for toast.promise (from ActivitySwiper):
```javascript
await toast.promise(asyncOperation(), {
  loading: 'Loading...',
  success: 'Success message',
  error: 'Error message'
})
```
  </action>
  <verify>
- Test cancel registration in ParticipantDashboard - verify toast appears
- Test registration in ActivityDetailModal - verify success toast
- Test create/edit/delete in ActivityManager - verify toasts
- No alert() calls remain in codebase for error handling
  </verify>
  <done>
- All async operations show toast on success/failure
- No alert() used for error messages
- Consistent toast message formatting
  </done>
</task>

<task type="auto">
  <name>Task 3: Add error recovery hints to error messages</name>
  <files>
frontend/src/services/api.js,
frontend/src/utils/errorUtils.js
  </files>
  <action>
Create centralized error message handling:

1. **Create frontend/src/utils/errorUtils.js:**
```javascript
export function getErrorMessage(error, context = 'operation') {
  // Extract message from various error formats
  const message = error.response?.data?.detail
    || error.response?.data?.message
    || error.message
    || 'An unexpected error occurred'

  // Add recovery hints based on status code
  const status = error.response?.status

  if (status === 401) {
    return 'Your session has expired. Please log in again.'
  }
  if (status === 403) {
    return 'You do not have permission to perform this action.'
  }
  if (status === 404) {
    return `The requested ${context} was not found.`
  }
  if (status === 422) {
    return 'Invalid data provided. Please check your input.'
  }
  if (status >= 500) {
    return 'Server error. Please try again in a few moments.'
  }
  if (!navigator.onLine) {
    return 'No internet connection. Please check your network.'
  }

  return message
}

export function showErrorToast(error, context = 'operation') {
  const toast = require('react-hot-toast').default
  toast.error(getErrorMessage(error, context))
}
```

2. **Update api.js** to use consistent error format in interceptor (if not already)

3. Update one component (ActivitySwiper.jsx) to use the new errorUtils as example pattern
  </action>
  <verify>
- Import getErrorMessage in ActivitySwiper and use it
- Simulate 500 error - verify user-friendly message shown
- Simulate offline - verify network error message
- Run: npm run lint (in frontend/) - no errors
  </verify>
  <done>
- errorUtils.js created with getErrorMessage and showErrorToast
- Error messages include recovery hints
- At least one component updated to use new pattern
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Activities page shows loading spinner during fetch
- [ ] All tested async operations show toast notifications
- [ ] Error messages are user-friendly (no raw error objects)
- [ ] No alert() calls for errors in modified files
- [ ] `npm run lint` passes in frontend/
- [ ] `npm run build` succeeds in frontend/
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Loading states visible on slow connections
- Error messages provide helpful context
- Consistent toast notification usage
</success_criteria>

<output>
After completion, create `.planning/phases/07-error-handling-feedback/07-01-SUMMARY.md`
</output>
